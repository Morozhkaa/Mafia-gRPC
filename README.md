# Mafia (gRPC)

Сервис, реализующий движок игры Mafia. Взаимодействие
между клиентом и сервером обеспечивается на технологии gRPC.

### Description of the game process
* Поддерживаются три роли: MAFIA, COMMISSAR, INNOCENT. Задать количество участников для каждой роли можно при запуске игры.

* При подключении заданного числа игроков, сервер создает новую сессию игры (вход в сессию осуществляется автоматически) и назначает участникам случайные роли в соответствии с требованиями . Есть также возможность ведения нескольких сеансов игры одновременно, поскольку каждому из сеансов назначается уникальный идентификатор.

* Изменения, происходящие в игре, можно отслеживать как на стороне клиента, так и на стороне сервера. 

    > Клиент, например, получает оповещения о подключении/отключении игроков, смене дня/ночи, необходимости повторного голосования, смерти других участников и тд. Также есть возможность следить за списком игроков и статусом игры.

    > На стороне сервера отображается дополнительная информация: кто за кого голосовал, сколько голосов было за каждого кандидата).  
     

     При выводе статуса игры можно увидеть всех участников и знаки `[x]` напротив тех, кто был убит.
```
=== GAME STATUS ========:
Your username: Olga
Players:
        [MAFIOSI]   Olga
        []          Katya
        []          Nadya
        []          Sergey       [x]
========================
```

Когда игрока убивают, он переводится в состояние «духа». То есть участвовать в обсуждении он больше не может (сообщения не будут отправляться), но при может следить за ходом игры и видеть роли оставшихся игроков. Выглядит это следующим образом: 

```
=== GAME STATUS ========:
Your username: Sergey
[MAFIOSI]   Olga
[INNOCENT]  Katya
[INNOCENT]  Nadya
[COMMISSAR] Sergey       [x]
========================
```


* На каждом шаге игры участнику доступен следующий __набор команд__:

        help - print this message.
        status - print the current game status.
        msg [text] - send a text message.
        kick [username] - vote for kick someone (available during the day).
        kill [username] - vote for kill someone (available for mafiosi at night).
        check [username] - check if the player is a mafia (available for commissar at night).  


* Игра считается завершенной, когда:
        
         1) Количество игроков с ролью “мафия” становится равно количеству игроков без роли (мирных жителей).
         2) Количество игроков с ролью “мафия” становится равно нулю.  


***

### Usage
* Чтобы сгенерировать код из .proto файла, нужно из папки pkg/proto выполнить следующие команды:
    
```
PATH=$PATH:$GOPATH/bin
protoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative mafia.proto
```

* Для запуска сервера и клиентов, из соответствующих папок (`bin/client` и `bin/server`) нужно выполнить команду: 
```
go run main.go
```


***
__Игровой день__:

1. В течение игрового дня участники могут общаться между собой, используя команду `msg [text]`.
2. После обсуждения каждый игрок должен выставить кандидата на голосование с помощью `kick [username]`.
3. Если кандидат с максимальным количеством голосов не единственный, то игрокам придет оповещение, что необходимо переголосовать.
4. Ночь наступает после однозначного определения главного подозреваемого (жертвы), который после казни переходит в состояние "духа", то есть может наблюдать за дальнейшим ходом игры, но не может участвовать в обсуждении и влиять на ход игры.

  
***

__Игровая ночь__:
1. Ночью члены мафии могут продолжать обсуждения с помощью команды `msg [text]`, сообщения будут отправлены только другим членам мафии, а также умершим игрокам, которые наблюдают за игрой.

2. Затем каждая мафия должна отправить команду `kill [username]`. Если жертва определена неоднозначно, придет оповещение, что нужно переголосовать.


3. Комиссар же ночью может с помощью команды `check [username]` узнать, является ли спрашиваемый игрок мафией.